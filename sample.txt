/** @file armskel.S
 *  @brief ARM Skeleton Program
 *   [What does this component do?]
 *
 *
 * [Optionally, more stuff about the component in general.]
 * This file must be processed using cpp before assembly.
 */

/* Copyright (C) 2007-2011 the NxOS developers
 *
 * See AUTHORS for a full list of the developers.
 *
 * Redistribution of this file is permitted under
 * the terms of the GNU Public License (GPL) version 2.
 */

#define __ASSEMBLY__
#include "base/interwork.h"
#include "base/lib/scaffolding/scaffolding.h"
#include "armdebug/Debugger/debug_stub.h"

/* To disable Manual Breakpoints, change the following to #undef ENABLE_BREAKPOINTS */
#define ENABLE_BREAKPOINTS

	.extern	nx_systick_wait_ms
	.equ	SYSTICK_1000MS, 1000
	.equ	SYSTICK_500MS, 500
	.equ	LOOPCNT, 3

.data
.align 4

title:	 .asciz "Armskel Prog"
prompt:	 .asciz "Welcome to NxOS"
content: .asciz "Hello!"
seq: .asciz "sequence :"
space: .asciz " "

.code 32
.text
.align 	4

/** main
 *    Main Program
 */
	.global	main
main:
	push	{lr}
	bl		nx_proginit
	/*
	ldr		r0, =title
	bl		nx_progtitle*/
	bl 		func_init

#ifdef ENABLE_BREAKPOINTS
	dbg__bkpt_arm
#else
	mov		r0, #SYSTICK_1000MS
	bl		nx_systick_wait_ms
#endif

break:
	nop		/* Provide GDB with a safe instruction to breakpoint at */

/********************* Begin Customization Here *********************/
func_init:			/* initialization */
	mov R4,#1		/* initialize x as 1 and store*/
	ldr r0, =seq
	bl nx_display_string
	mov r0,#SYSTICK_500MS
	bl		nx_systick_wait_ms
	bl func 	/* go into loop */ 
func:
	
	mul R5, R4, R4		/* compute square of x and store */
	mov R8, #5			
	mul R6, R4, R8		/* compute 5 multiple x and store */
	
	Add R7, R6, #6		/* compute 5x + 6 and store */
	Add R7, R5, R7		/* compute x^2 + 5x +6 and store */
	
	mov R0, R7
	bl nx_display_int	/* print sum */
	mov		r0, #SYSTICK_500MS		/* Wait 500 ms */
	bl		nx_systick_wait_ms
	ldr r0, =space
	bl nx_display_string
	mov r0,#SYSTICK_500MS
	bl		nx_systick_wait_ms

	ADD R4, #1		/* increase x by 1*/
	cmp R4, #7		/* check if x is less than 7 or not */
	blt func 		/* if yes loop back, else exit loop */
endfunc:






	mov		r7, #LOOPCNT
loop:
	ldr		r0, =prompt
	bl		nx_progtitle

	mov		r0, #SYSTICK_500MS		/* Wait 500 ms */
	bl		nx_systick_wait_ms

	ldr		r0, =content
	bl		nx_progcontent

	mov		r0, #SYSTICK_1000MS		/* Wait 1000 ms */
	bl		nx_systick_wait_ms

/* Change '0' to '1' to enable program loop */
#if 0
	subs	r7, r7, #1
	bne		loop
#endif

/********************** End Customization Here **********************/
exit_main:
	bl		nx_progshutdown
	pop		{pc}

.end

